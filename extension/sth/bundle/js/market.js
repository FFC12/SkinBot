var market=webpackJsonp_name_([6],{127:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(s,o){try{var a=t[s](o),c=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}return n("next")})}}var o=r(71),a=function(t,r){var n=this;r=r||!1;var a=function(e){var t=[];for(var r in e)t.push(r+"="+encodeURIComponent(e[r]));return t.join("&")},c={db:{},dbConf:{},can:function(e,t){return this.db.hasOwnProperty(e)?Date.now()-this.db[e]>t&&(this.db[e]=Date.now(),!0):(this.db[e]=Date.now(),!0)}},i=new function(e){var t=arguments,r=this;this.pool=[];var n=function(e,t,r){return r=r?"getUTC":"get",t.replace(/%[YmdHMS]/g,function(t){switch(t){case"%Y":return e[r+"FullYear"]();case"%m":t=1+e[r+"Month"]();break;case"%d":t=e[r+"Date"]();break;case"%H":t=e[r+"Hours"]();break;case"%M":t=e[r+"Minutes"]();break;case"%S":t=e[r+"Seconds"]();break;default:return t.slice(1)}return("0"+t).slice(-2)})},s=function(e){for(var s=[],o=0;o<e.length;o++)e[o]=t[o],"string"!=typeof e[o]&&(e[o]=JSON.stringify(e[o])),s.push(e[o]);r.pool.push(n(new Date,"%H:%M:%S",!0)+" "+s.join(" ")),r.pool.length>200&&r.pool.splice(0,1)};this.log=function(){s(arguments)},this.error=function(){s(arguments)}}(r),u={cnt:{},get:function(e,t){return this.cnt.hasOwnProperty(e)||(this.cnt[e]=0),this.cnt[e]>=t.length-1&&(this.cnt[e]=t.length-1),t[this.cnt[e]++]},reset:function(e){this.cnt[e]=0}},f=function(){var e=s(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)return e(n.response)},n.onerror=function(e){return r(e)},n.open("GET",t,!0),n.send("")}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),d=function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)return t(r.response,null)},r.onerror=function(e){return t(null,e)},r.open("GET",e,!0),r.send("")},p=function(e){var t=this;this.connId=null,this.address=e;var r=!0,n=null,s=function e(r){return chrome.webRequest.onBeforeRedirect.removeListener(e),n?(t.write("validateOpenIDSteamResponse",{link:r.redirectUrl},function(e){n(e),n=null}),{}):{}},o=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},c=void 0,f={},p={},m=function e(){var n=void 0,s=void 0,o=!0;r=!0,i.log("connect"),c=new WebSocket(t.address),c.onopen=function(e){i.log("ws opened"),t.emit("connect",e),o=!0,u.reset("ws_reconnect"),n=setInterval(function(){if(!1===o)return i.error("heart beat problem"),n&&(clearInterval(n),n=null),c.close(4001,"heart beat problem");c.send("ping"),o=!1},15e3)},c.onclose=function(o){i.log("closed WS connection"),t.connId=null,n&&(clearInterval(n),n=null),s&&(clearInterval(s),s=null),r&&(s=setTimeout(e,u.get("ws_reconnect",[2e3,3e3,5e3,15e3,3e4,4e4,6e4]))),t.emit("close",o)},c.onerror=function(e){i.error(e),t.emit("error",e)},c.onmessage=function(e){try{if("pong"===e.data)return o=!0;var r=JSON.parse(e.data);if("auth ok"===r.e)return t.isAuth=!0,t.connId=r.d.cid,t.emit("auth",t.connId);if(r.hasOwnProperty("h"))return p[r.h](r.d);if(r.hasOwnProperty("c"))return t.emit(r.e,r.d,function(e){r.d=e,c.send(JSON.stringify(r))});if(f.hasOwnProperty(r.e))return t.emit(r.e,r.d)}catch(e){i.error(e)}}};this.connect=function(){this.isActive()||m()},this.setAddress=function(e){t.address=e},this.on=function(e,t){return f.hasOwnProperty(e)||(f[e]=[]),f[e].push(t),this},this.close=function(e,t){r=!1,c&&c.readyState!==c.CLOSED&&c.close(e,t)},this.restart=function(e,t){c&&c.readyState!==c.CLOSED&&c.close(e,t)},this.isActive=function(){return c&&(c.readyState===c.OPEN||c.readyState===c.CONNECTING)},this.isConnected=function(){return c&&c.readyState===c.OPEN},this.emit=function(e,t,r){if(!f.hasOwnProperty(e))return!1;f[e].forEach(function(e,n){try{e(t,r)}catch(e){i.log(e)}})},this.write=function(e,t,r){try{var n={e:e,d:t};"function"==typeof r&&(n.h=o(),p[n.h]=r),c.send(JSON.stringify(n))}catch(e){}},this.authViaToken=function(e,t,r){r?this.write("authViaToken",{p:e,t:t,type:"extension",version:.1},function(e){"function"==typeof r&&r(e)}):this.write("authViaToken",{p:e,t:t,type:"extension",version:.1})},this.authViaOpenID=function(e){this.write("authSteam",{type:"extension",version:.1},function(t){t.success&&(i.log(t.url),d(t.url,function(t,r){if(r)return e({success:!1,error:r.message});var o=t.match(/steamId = false/i);if(o&&o.hasOwnProperty(0))return e({success:!1,error:"need auth"});var c=document.createElement("div");c.innerHTML=t;var i=c.querySelector("#openidForm").getAttribute("action"),u={};c.querySelectorAll("#openidForm input").forEach(function(e,t){u[e.getAttribute("name")]=e.getAttribute("value")}),n=e,setTimeout(function(){n&&(n({success:!1}),n=null)},3e4),chrome.webRequest.onBeforeRedirect.addListener(s,{urls:["https://steamcommunity.com/openid/login"]});var f=new XMLHttpRequest;f.open("POST",i,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.send(a(u))}))})},this.authViaJWT=function(e,t){i.log("authViaJWT"),this.write("authViaJWT",{t:e,type:"extension",version:.1},function(e){return t(e)})}},m=void 0,h="https://steamcommunity.com",l=t,g=void 0,v=void 0,y=!0,w=!0,k=!0,O=!1,S="",A="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5bd56c1aa4644a474a2e4972be27ef9e82e517e_full.jpg",I=(window.navigator.language,{});I.start=function(e,t){return i.log("start"),n.start(),t({success:!0})},I.checkInstall=function(e,t){return i.log("checkInstall"),t({success:!0})},I.getLogs=function(e,t){return t({success:!0,data:i.pool})},I.getApiKey=function(t,r){if(!c.can("getApiKey",2e3))return r({success:!1,error:429});d("https://steamcommunity.com/dev/apikey",function(t,n){if(n)return i.error("getApiKey: fail"),r({success:!1,error:n.status,message:n.message,steamKey:null,steamId:null});var s=document.createElement("div");s.innerHTML=t;var o=s.querySelector("#bodyContents_ex").textContent.match(/: ([A-Z0-9]+)/),a=t.match(/steamId = ["](\d+)["]/i);return a&&a.hasOwnProperty(1)&&o&&o.hasOwnProperty(1)?(i.log("getApiKey: ok"),O=!0,v=a[1],r({success:!0,steamKey:o[1],steamId:a[1],needAuth:!1})):(a=e(t).text().match(/steamId = false/i),r({success:!1,steamKey:null,steamId:null,needAuth:a&&a.hasOwnProperty(0)}))})},I.getTradeLink=function(t,r){return c.can("getTradeLink",2e3)?g?void d("https://steamcommunity.com/profiles/"+g+"/tradeoffers/privacy",function(t,n){if(n)return i.error("getTradeLink: fail"),r({success:!1,error:n.status,message:n.message});var s=document.createElement("div");s.innerHTML=t;var o=s.querySelector("#trade_offer_access_url").value,a=t.match(/steamId = ["](\d+)["]/i);return a&&a.hasOwnProperty(1)&&o?(i.log("getApiKey: ok"),r({success:!0,tradeOfferUrl:o,steamId:a[1]})):(a=e(t).text().match(/steamId = false/i),r({success:!1,tradeOfferUrl:null,steamId:null,needAuth:a&&a.hasOwnProperty(0)}))}):r({success:!1,message:"need auth"}):r({success:!1,error:429})},I.createOffer=function(e,t){if(!c.can("createOffer",3e3))return t({success:!1,error:429});d(h,function(r,n){if(n)return i.error("createOffer cant give sessionId"),t({success:!1,error:999});if(e.hasOwnProperty("time")&&e.time){i.log(e);var s=Date.now()-P-e.time;if(Math.abs(s)>1e4)return t({success:!1,error:408,message:"diff time more 10000ms "+s});i.log("Create offer, diff time",s)}var o=r.match('g_sessionID = ["]([a-zA-Z0-9]+)["]')[1];if(!o)return i.error("cant give sessionId"),t({success:!1,error:999});var c=e.post;c.sessionid=o;var u=new XMLHttpRequest;u.open("POST","https://steamcommunity.com/tradeoffer/new/send",!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),u.onload=function(){return 200===u.status?(chrome.notifications.create({type:"basic",title:"Market app",message:"Trade created, need confirm it in the phone",iconUrl:"/assets/market/market.svg",silent:!0}),i.log("createOffer: ok"),t({success:!0,response:JSON.parse(u.responseText)})):(chrome.notifications.create({type:"basic",title:"Market app",message:"Error create offer: "+u.responseText,iconUrl:"/assets/market/market.svg",silent:!0}),i.error("createOffer: fail",u.responseText),t({success:!1,error:u.responseText}))},u.send(a(c))})},I.acceptOffer=function(e,t){if(!c.can("acceptOffer",3e3))return t({success:!1,error:429,message:"to many request"});d(h,function(r,n){if(n)return i.error("acceptOffer cant give sessionId"),t({success:!1,error:999});var s=r.match('g_sessionID = ["]([a-zA-Z0-9]+)["]')[1];if(!s)return i.error("acceptOffer cant give sessionId"),t({success:!1,error:999});if(e.hasOwnProperty("time")&&e.time){var o=Date.now()-P-e.time;if(Math.abs(o)>1e4)return t({success:!1,error:408,message:"diff time more 10000ms "+o});i.log("acceptOffer, diff time",o)}var c=e.post;c.sessionid=s;var u=new XMLHttpRequest;u.open("POST","https://steamcommunity.com/tradeoffer/"+c.tradeofferid+"/accept",!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),u.onload=function(){return 200===u.status?(i.log("acceptOffer: ok"),t({success:!0,response:u.responseText})):(i.error("acceptOffer: fail",u.responseText),t({success:!1,error:u.responseText}))},u.send(a(c))})};var T=function(e,t,r){d(h,function(n,s){if(s)return i.error("acceptOffer cant give sessionId"),r({success:!1,error:999});var o=n.match('g_sessionID = ["]([a-zA-Z0-9]+)["]')[1];if(!o)return i.error("acceptOffer cant give sessionId"),r({success:!1,error:999});var c={};c.sessionid=o;var u=new XMLHttpRequest;u.open("POST","https://steamcommunity.com/tradeoffer/"+e+"/"+t,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),u.onload=function(){return 200===u.status?(i.log("acceptOffer: ok"),r({success:!0,response:u.responseText})):(i.error("acceptOffer: fail",u.responseText),r({success:!1,error:u.responseText}))},u.send(a(c))})};I.cancelOffer=function(e,t){if(!c.can("cancelOffer",2e3))return t({success:!1,error:429});T(e.tradeOfferId,"cancel",t)},I.declineOffer=function(e,t){if(!c.can("declineOffer",2e3))return t({success:!1,error:429});T(e.tradeOfferId,"decline",t)},I.getSteamId=function(e,t){if(!c.can("getSteamId",2e3))return t({success:!1,error:429});d("https://steamcommunity.com/my/",function(e,r){if(r)return i.error("getSteamId fail"),t({success:!1,steamId:null});var s=o.a.Profile.parse(e,["scriptText","steamId","avatarSrc","nickname"]),a=s.scriptText,c=s.steamId,u=s.avatarSrc,f=s.nickname;if(A=u,S=f,A&&n.setStorage("ava",A),S&&n.setStorage("nickName",S),c)return v=c,t({success:!0,steamId:c});var d=a.match(/steamId = false/i);return t({success:!1,steamId:null,needAuth:d&&d.hasOwnProperty(0)})})};var b=Date.now(),x=!1,P=0,H=new p(l);H.on("connect",s(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getStorage("authToken");case 2:if(!(t=e.sent)){e.next=6;break}return i.log("auth via token..."),e.abrupt("return",H.authViaJWT(t,function(e){if(!e||!e.success)return n.setStorage("authToken",""),setTimeout(H.restart,u.get("reconnect_authOpenId",[6e4,12e3,3e5,6e5,12e5]));g=e.steamID,P=Date.now()-e.timestamp,i.log("diff time:",P),m.setStatus("✓","#b7e8b1")}));case 6:return i.log("auth via openid..."),e.abrupt("return",H.authViaOpenID(function(e){if(!e||!e.success)return"need auth"===e.error?setTimeout(H.restart,u.get("reconnect_authOpenId",[6e4,12e3,3e5,6e5,12e5])):H.restart();g=e.steamID,P=Date.now()-e.timestamp,i.log("diff time:",P),m.setStatus("✓","#b7e8b1")}));case 8:case"end":return e.stop()}},e,n)}))),H.on("authToken",function(e){n.setStorage("authToken",e.t)}),H.on("auth",function(e){var t=this;i.log("auth ok"),O||I.getApiKey({},function(){}),b=Date.now();var r=function(){if(b+3e5<Date.now())return i.log("more 300s cant check auth"),t.setStorage("authToken",""),H.close(4002,"more 300s cant check auth"),R();I.getSteamId({},function(e){return e.needAuth?(i.log("check auth: need auth"),t.setStorage("authToken",""),H.close(4002,"need auth"),R()):e.success&&e.steamId!==g?(i.log("check auth: diff steamid"),t.setStorage("authToken",""),u.reset("need_start"),H.close(4002,"diff steamid"),R()):void(e.success&&(i.log("check auth: ok"),b=Date.now(),H.isConnected()||H.connect()))})};x&&clearInterval(x),x=setInterval(r,6e4)}),H.on("getApiKey",function(e,t){return I.getApiKey({options:e},function(e){return t(e&&e.success&&e.steamId===g?{success:!0,data:e.steamKey,steamId:e.steamId}:{success:!1})})}),H.on("getSteamId",function(e,t){return I.getSteamId({options:e},function(e){return t(e&&e.success&&e.steamId===g?{success:!0,data:e.steamKey,steamId:e.steamId}:{success:!1})})}),H.on("getTradeLink",function(e,t){return t||(t=function(e){}),I.getTradeLink(e,t)}),H.on("getLogs",function(e,t){return I.getLogs({options:e},function(e){return t(e)})}),H.on("acceptOffer",function(e,t){return t||(t=function(e){}),I.acceptOffer(e,t)}),H.on("cancelOffer",function(e,t){return t||(t=function(e){}),I.cancelOffer(e,t)}),H.on("declineOffer",function(e,t){return t||(t=function(e){}),I.declineOffer(e,t)}),H.on("sendOffer",function(e,t){return t||(t=function(e){}),I.createOffer(e,t)}),H.on("recheckStart",function(e){H.close(4002,"recheck start"),R()}),H.on("close",function(e){i.log("ws closed",e.code,e.reason),x&&clearInterval(x),g=null}),H.on("notify",function(e){chrome.notifications.create({type:"basic",title:e.title,message:e.message,iconUrl:"/assets/market/market.svg",silent:!1})});var L=void 0,R=function e(){i.log("checkNeedStart"),L&&clearTimeout(L),y&&I.getSteamId({},function(){var t=s(regeneratorRuntime.mark(function t(r){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(k=r.needAuth,r.success&&r.steamId){t.next=5;break}return i.log("checkNeedStart get steamid fail"),L=setTimeout(e,u.get("need_start",[5e3,6e4,6e4,6e4,18e4,3e5])),t.abrupt("return");case 5:return t.prev=5,t.next=8,f("https://market.csgo.com/api/cnds?id="+r.steamId);case 8:if(s=t.sent,!(s=JSON.parse(s))||!s.success){t.next=13;break}return i.log("need auth ok"),t.abrupt("return",H.connect());case 13:i.log("not need start"),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(5),i.error("error",t.t0);case 19:L=setTimeout(e,u.get("need_start",[5e3,6e4,6e4,6e4,18e4,3e5]));case 20:case"end":return t.stop()}},t,n,[[5,16]])}));return function(e){return t.apply(this,arguments)}}())};chrome.runtime.onConnectExternal.addListener(function(e){e.onMessage.addListener(function(t){var r=function(r){r.c=t.c,e.postMessage(r)};return I.hasOwnProperty(t.cmd)?I[t.cmd](t,r):r({success:!1,error:404,message:"unknown command"})})}),chrome.runtime.onMessage.addListener(function(e,t,r){if(e.hasOwnProperty("type"))return!0;var n=function(t){t.c=e.c,r(t)};return I.hasOwnProperty(e.cmd)?(I[e.cmd](e,n),!0):(n({success:!1,error:404,message:"unknown command"}),!0)}),this.start=function(){return y=!0,m.setStatus("✓","#a9a9a9"),u.reset("need_start"),R(),!0},this.setWSAddress=function(e){return H.setAddress(e),n},this.extension=function(e){m=e},this.stop=function(){return y=!1,m.setStatus(""),H.close(),!0},this.setStorage=function(e,t){var r={};r[e]=t,chrome.storage.local.set(r)},this.getStorage=function(){var e=s(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){chrome.storage.local.get(t,function(r){e(r[t])})}));case 1:case"end":return e.stop()}},e,n)}));return function(t,r){return e.apply(this,arguments)}}(),this.isActive=function(){return y},this.getAva=function(){return A},this.getNickName=function(){return S},this.hasApiKey=function(){return O},this.getSteamId64=function(){return v},this.isConnected=function(){return H&&H.isConnected()},this.needSteamAuth=function(){return k},this.onAutoAcceptTrades=function(){w=!0},this.setServer=function(e){server=e},this.offAutoAcceptTrades=function(){w=!1},this.isAutoAcceptTrades=function(){return w}},c=function(e){var t=null,r=e.url,n=e.method,s=/https:\/\/steamcommunity.com\/tradeoffer\/(\d+)\/accept/gi,o=/https:\/\/steamcommunity.com\/tradeoffer\/new\/send/gi,a=/https:\/\/steamcommunity.com\/tradeoffer\/(\d+)\/decline/gi;switch(!0){case s.test(r)&&"POST"===n.toUpperCase():t=r.replace("/accept","");break;case o.test(r)&&"POST"===n.toUpperCase():t=r.replace("/send","");break;case a.test(r)&&"POST"===n.toUpperCase():t=r.replace("/decline","");break;default:t=null}if(t){var c=e.requestHeaders.indexOf(function(e){return"referer"===e.name.toLowerCase()});e&&e.requestHeaders&&(void 0!==c&&c>=0?e.requestHeaders[c].value=t:e.requestHeaders.push({name:"Referer",value:t}))}return{requestHeaders:e.requestHeaders}};chrome.webRequest.onBeforeSendHeaders.addListener(c,{urls:["https://steamcommunity.com/tradeoffer/*"]},["requestHeaders","blocking","extraHeaders"]);var i=function(){function e(){var t=this;n(this,e),this.server=null,this.marketApp=new a("wss://appws.dota2.net/"),this.marketApp.extension(this),this.marketApp.getStorage("server").then(function(e){e=e||"world",t.setServer(e)})}return e.prototype.setStatus=function(e,t){t=t||"gray"},e.prototype.getWSAddress=function(){return"wss://appws.dota2.net/"},e.prototype.setServer=function(e){e!==this.server&&(this.server=e,this.marketApp.stop(),this.marketApp.setStorage("server",this.server))},e.prototype.isActive=function(){this.marketApp.isActive.call(this.marketApp)},e.prototype.isAutoAcceptTrades=function(){this.marketApp.isAutoAcceptTrades.call(this.marketApp)},e.prototype.onAutoAcceptTrades=function(){this.marketApp.onAutoAcceptTrades.call(this.marketApp)},e.prototype.offAutoAcceptTrades=function(){this.marketApp.offAutoAcceptTrades.call(this.marketApp)},e.prototype.start=function(){this.marketApp.start.call(this.marketApp)},e.prototype.stop=function(){this.marketApp.stop.call(this.marketApp)},e}();t.default=new i}.call(t,r(69))},611:function(e,t,r){r(3),e.exports=r(127)},69:function(e,t){e.exports=jQuery}},[611]);